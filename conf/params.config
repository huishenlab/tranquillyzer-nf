// conf/params.config

params {

  /*
   * UX / meta
   */
  help    = false
  version = false

  /*
   * ETL behavior
   */
  cleanup_transform = false

  /*
   * Required inputs
   */
  samplesheet = null
  reference   = null
  outdir      = './results'

  /*
   * Optional inputs
   */
  gtf = null

  /*
   * Execution selection (profiles preferred)
   */
  executor = 'local'

  /*
   * Container configuration
   */
  container_engine  = 'apptainer'
  container_trq     = 'varishenlab/tranquillyzer:tranquillyzer_v0.2.1_tf2.15.0'
  container_subread = 'varishenlab/featurecounts:subread2.0.6_py3.10.12'
  image_dir         = "${baseDir}/container_images"

  /*
   * GPU toggles + optional scheduler flags
   */
  enable_gpu     = false
  slurm_gpu_opts = ''

  /*
   * Apptainer/Singularity GPU library support (site-specific; leave empty in repo)
   * Override via:
   *   - command line: --cuda_lib_dir ... --container_binds ...
   *   - a site config: conf/site/<cluster>.config
   */
  cuda_lib_dir        = "/cm/local/apps/cuda/libs/current/lib64"
  container_binds         = [
    '/varidata:/varidata',
    '/cm/local/apps/cuda/libs/current/lib64:/cm/local/apps/cuda/libs/current/lib64'
  ]
  container_extra_opts = ''

  /*
   * SLURM defaults (used by slurm profile)
   */
  slurm_queue = null
  slurm_time  = '24h'
  slurm_cpus  = 8
  slurm_mem   = null

  /*
   * Cloud scaffolding (used by profiles)
   */
  workDir       = null
  aws_region    = null
  aws_queue     = null
  gcp_project   = null
  gcp_region    = null
  azure_account = null
  azure_region  = null
  k8s_namespace = 'default'

  /*
   * Throttling / concurrency
   */
  queueSize               = 10

  preprocess_maxForks     = 1
  readlengthdist_maxForks = 1
  annotate_maxForks       = 1
  align_maxForks          = 1
  dedup_maxForks          = 1
  splitbam_maxForks       = 1
  featurecounts_maxForks  = 1

  /*
   * Pipeline toggles
   */
  split_bam     = true
  featurecounts = true

  /*
   * Tool options
   */
  preprocess_opts = '--output-base-qual --threads 2'

  annotate_reads_opts = [
    '--output-fmt fastq',
    '--model-name 10x3p_sc_ont_011',
    '--model-type CRF',
    '--chunk-size 300000',
    '--bc-lv-threshold 2',
    '--threads 2'
  ].join(' ')

  align_opts = '--threads 2'
  dedup_opts = '--threads 2 --lv-threshold 2'

  split_bam_opts = [
    '--bucket-threads 2',
    '--merge-threads 2',
    '--max-open-cb-writers 64'
  ].join(' ')

  featurecounts_opts = '--threads 2 --batch-size 200 --extra "-g gene_id -t exon -s 1"'
}